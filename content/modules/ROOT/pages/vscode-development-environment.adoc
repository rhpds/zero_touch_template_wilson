= VS Code Development Environment
:estimated-time: 15-20 minutes

== Learning Outcomes

By the end of this guide, you will:

* **Access and use** the browser-based VS Code development environment
* **Understand SSH integration** with lab VMs for seamless development
* **Configure and customize** the development environment for your needs
* **Apply best practices** for Zero Touch template development

== Overview

The VS Code container provides a complete browser-based development environment with automatic repository cloning, SSH integration to lab VMs, and pre-configured development tools for Zero Touch template customization.

== Key Features

**âœ… Browser-Based IDE**: Complete VS Code experience in your browser  
**âœ… Auto-Setup**: Repository cloned, development branch created automatically  
**âœ… SSH Integration**: Seamless connection to lab VMs with pre-configured keys  
**âœ… Security**: Password-protected access using lab credentials  

[NOTE]
====
**Alternative**: You can also use the `ocp4_workload_codeserver` AgnosticD workload for enterprise-standard deployment. This template uses a **custom container approach** for maximum flexibility and educational value.
====

== Quick Start

**Accessing VS Code:**
1. **Click "ðŸ’» VS Code" tab** in your lab interface
2. **Enter password** (same as SSH access)
3. **Wait 30-60 seconds** for startup
4. **Start developing** - Repository is pre-loaded

== SSH Integration

The VS Code container **automatically connects to lab VMs** using AgnosticD-generated SSH keys.

**âœ… What Works Automatically:**
- SSH keys from AgnosticD deployment
- Terminal profiles for lab-server connection
- Passwordless SSH to VMs (when network policy configured)

[IMPORTANT]
====
**Network Policy Required for SSH Access**

For VS Code to SSH to lab VMs, configure network policy in deployment variables:

[source,yaml]
----
zero_touch_ingress_lockdown_rules:
  - from:
      - podSelector:
          matchLabels:
            app.kubernetes.io/name: vscode
    ports:
      - protocol: TCP
        port: 22
----

**Details**: xref:network-policy-configuration.adoc[Network Policy Configuration Guide]
====

**Using SSH in VS Code:**

- **Open Terminal** (`Ctrl+` `) â†’ Automatically connects to lab-server
- **Manual SSH**: `ssh rhel@lab-server` (uses AgnosticD keys or password)  
- **Remote-SSH Extension**: `Ctrl+Shift+P` â†’ "Remote-SSH: Connect to Host"

== Development Workflow

**Repository Setup:**
- Repository automatically cloned to `/workspace/zero_touch_template_wilson/`
- Development branch `lab-development` created automatically
- Git configured with default user settings

**Common Tasks:**
- **Edit Configuration**: Modify `instances.yaml`, `firewall.yaml`, `ui-config.yml`
- **Create Content**: Add new `.adoc` files in `content/modules/ROOT/pages/`
- **Test Changes**: Use terminal SSH to test configurations on lab-server
- **Version Control**: Commit and push changes using integrated Git

**Best Practices:**
- âœ… Use consistent naming between configuration files
- âœ… Test changes before committing
- âœ… Keep DNS names aligned across `instances.yaml` and `ui-config.yml`
- âœ… Use branches for experimental work

== Container Configuration Reference

The VS Code container uses Red Hat UBI9 with the following key configuration:

[source,yaml]
----
containers:
  - name: "vscode"
    image: "registry.redhat.io/ubi9/ubi:latest"
    memory: "4G"
    cpu: "1"
    ports:
      - name: vscode
        containerPort: 8080
        protocol: TCP
    environment:
      PASSWORD: "{{ common_password }}"
      RHEL_USER: "{{ zero_touch_rhel_user_user_name | default('rhel') }}"
      SSH_PRIVATE_KEY: "{{ hostvars.localhost.ssh_provision_pubkey_content }}"
    commands:
      - "dnf install -y git openssh-clients"
      - "curl -fsSL https://code-server.dev/install.sh | sh"
      # ... additional setup commands
    routes:
      - name: vscode
        host: vscode
        service: vscode
        targetPort: 8080
        tls: true
----

**Key Elements:**
- **UBI9 Base**: Enterprise-ready Red Hat image
- **Code-server Installation**: Official binary installation method
- **AgnosticD Integration**: Uses deployment SSH keys and lab patterns
- **Automatic Setup**: Git clone, user creation, SSH configuration

== Troubleshooting

**Common Issues:**

**ðŸ”§ VS Code Won't Load**
- Wait 60+ seconds for initial startup
- Check browser console for errors
- Verify route is accessible

**ðŸ”§ SSH Connection Failed**
- Check network policy configuration
- Verify AgnosticD SSH keys are available
- Try manual password SSH as fallback

**ðŸ”§ Repository Not Cloned**
- Check container logs for Git errors
- Verify GitHub repository accessibility
- Try manual clone if automatic fails

**Debug Commands:**
[source,bash]
----
# Check container status
kubectl get pods | grep vscode

# View container logs
kubectl logs deployment/vscode

# Access container directly
kubectl exec -it deployment/vscode -- /bin/bash
----

== Related Documentation

**Essential References:**
* xref:container-basics.adoc[**Container Basics**] - Understanding container configuration
* xref:network-policy-configuration.adoc[**Network Policy Configuration**] - SSH access configuration
* xref:template-customization-guide.adoc[**Template Customization Guide**] - Overall template development

**Development Guides:**
* xref:content-authoring-basics.adoc[**Content Authoring Basics**] - Writing lab content
* xref:development-lifecycle-guide.adoc[**Development Lifecycle**] - Complete development workflow
* xref:vm-basics.adoc[**VM Basics**] - Understanding lab VMs

**The VS Code development environment provides the fastest way to customize and develop Zero Touch lab templates directly in your browser!**