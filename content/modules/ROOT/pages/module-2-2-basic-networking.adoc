= Module 2.2: Basic Networking
:estimated-time: 15-20 minutes

== Learning Objectives

Upon completion, you will understand:

* Basic network configuration for labs
* VM connection to custom networks
* Network isolation concepts
* Network connectivity testing

== Overview

Networks define how your VMs communicate with each other and the internet. This module covers creating a simple multi-VM environment with network separation.

== Step 1: Understand Network Basics

Your lab includes:
* **Default network**: Provides internet access (automatic)
* **Custom networks**: Isolate groups of VMs

=== Default Network Behavior

Every VM automatically gets:
* Internet connectivity via NAT
* Outbound access for package installation
* Inbound access blocked (secure by default)

== Step 2: Create Your First Custom Network

Edit `config/networks.yaml`:

.Multi-Tier Network Configuration <<agnosticd-base>>
[source,yaml]
----
---
# Default network exists by default, specify here always.
- name: default

- name: "web-tier"
  cidr: "10.10.0.0/24"  
  description: "Web servers network"

- name: "db-tier"
  cidr: "10.20.0.0/24"
  description: "Database network"
----

=== Network Parameters

* **name**: Unique identifier (use hyphens, not spaces)
* **cidr**: IP address range in CIDR notation  
* **description**: Human-readable explanation

== Step 3: Connect VMs to Networks

Update `config/instances.yaml` to use your networks:

[source,yaml]
----
---
virtualmachines:
  - name: "web-server"
    image: "rhel-9.6"
    cores: 2
    memory: "4G"
    networks:
      - default      # Internet access
      - web-tier     # Custom network
      
  - name: "database"
    image: "rhel-9.6"
    cores: 2
    memory: "4G" 
    networks:
      - db-tier      # Isolated network only
----

=== Network Assignment Rules

* **Include `default`** for internet access
* **Use custom networks** for VM-to-VM communication
* **VMs on same network** can communicate
* **VMs on different networks** are isolated

== Step 4: Configure Firewall for Networks

Update `config/firewall.yaml` to allow network communication:

[source,yaml]
----
---
egress:
  - port: 80
    protocol: tcp
    description: "HTTP for packages"
  - port: 443
    protocol: tcp
    description: "HTTPS for packages"
  - port: 53
    protocol: udp
    description: "DNS"

ingress:
  - port: 22
    protocol: tcp
    description: "SSH access"
  - port: 80
    protocol: tcp
    description: "Web server access"
----

== Step 5: Deploy and Test

Build your documentation:

[source,bash]
----
# Generate documentation
antora generate site.yml
----

After deployment, test your networks:

[source,bash]
----
# On web-server VM
hostname
ip addr show

# Test internet connectivity
ping -c 3 google.com

# Test connectivity to database (should fail - different networks)
ping -c 3 database
----

[source,bash]
----
# On database VM  
hostname
ip addr show

# Database has no internet (no default network)
ping -c 3 google.com  # This should fail
----

== Step 6: Understanding Network Isolation

Your configuration creates:

=== Web Tier (web-server VM)
* **Internet access**: Can download packages, reach external APIs
* **Web tier access**: Can reach other web servers (if you add more)
* **Database access**: **BLOCKED** - cannot reach database directly

=== Database Tier (database VM)  
* **Internet access**: **BLOCKED** - more secure
* **Database access**: Can reach other database servers
* **Web tier access**: **BLOCKED** - isolated from web tier

This creates **defense in depth** - even if web server is compromised, database remains isolated.

==  Network Design Principles

=== Security Through Isolation
* **Separate tiers** with different trust levels
* **Limit internet access** to only what's needed
* **Control communication** between tiers

=== Practical Lab Design
* **Web servers**: Need internet + web tier
* **Application servers**: Web tier + app tier  
* **Databases**: App tier only (most secure)
* **Jump boxes**: All networks (for administration)

==  Testing Your Network Design

Verify your configuration works:

- [ ] **Web server** has internet access
- [ ] **Database** is isolated from internet  
- [ ] **VMs on same network** can communicate
- [ ] **VMs on different networks** are isolated
- [ ] **SSH access** works through firewall

== Common Networking Patterns

=== Development Environment

[source,yaml]
----
- name: "dev-network"
  cidr: "192.168.100.0/24"
  description: "Development VMs"
----

=== Production-Like Separation

[source,yaml]
----
- name: "dmz"
  cidr: "10.1.0.0/24"
  description: "Public-facing services"
  
- name: "internal"
  cidr: "10.2.0.0/24" 
  description: "Internal applications"
----

== Troubleshooting Networks

**VMs can't communicate?**
→ Check they're on the same custom network

**No internet access?**
→ Ensure VM includes `default` network  

**Can't SSH to VMs?**
→ Check firewall allows port 22 ingress

**IP address conflicts?**
→ Verify CIDR ranges don't overlap

== Summary

You now understand:

* **Network isolation** and security principles  
* **Custom network creation** and configuration  
* **VM-to-network assignment** patterns  
* **Firewall integration** with networking  
* **Testing and validation** of network design  

== Next Steps

Continue with:
* xref:module-2-3-simple-content.adoc[Module 2.3: Simple Content Creation] - Add educational content
* xref:networking-basics.adoc[Networking Basics Reference] - More advanced networking features

You're building real skills in infrastructure design and security! 

[bibliography]
== References

* [[[agnosticd-base]]] Red Hat GPTE Team. AgnosticD Zero Touch Base RHEL Configuration. 
  `/home/wilson/Projects/agnosticd/ansible/configs/zero-touch-base-rhel/default_vars_openshift_cnv.yaml`. 2024.

* [[[template-instances]]] Red Hat GPTE Team. Zero Touch Template Instance Configuration. 
  `/home/wilson/Projects/zero_touch_template_wilson/config/instances.yaml`. 2024.
