= Template Customization Guide

== Learning Outcomes

By the end of this guide, you will:

* **Customize Zero Touch templates** to meet specific lab requirements
* **Configure infrastructure components** (VMs, containers, networking, security)
* **Design lab user experiences** with proper UI configuration and navigation
* **Apply advanced extension patterns** using AgnosticD workloads and custom configurations
* **Troubleshoot common customization issues** and implement best practices

üí° **New to Zero Touch?** Consider starting with our xref:zero-touch-platform-training.adoc[**Self-Paced Training Program**] for step-by-step guidance.

== Overview

The template allows you to customize several key aspects:

* **Instances**: Add virtual machines and containers to your lab environment
* **Networking**: Configure custom networks and connectivity between instances
* **Firewall**: Define ingress and egress rules for network security
* **Content**: Create educational content using AsciiDoc and configure the lab interface
* **UI Configuration**: Set up navigation, tabs, and interactive elements

== Configuration Files

Template customization involves several key configuration files:

=== Infrastructure Configuration (`config/` directory)

[cols="1,3"]
|===
|File |Purpose

|`instances.yaml`
|Defines virtual machines and containers, including their specifications, networks, and services

|`networks.yaml`
|Configures custom networks and network topology

|`firewall.yaml`
|Sets up ingress and egress firewall rules for network security
|===

=== Content and UI Configuration

[cols="1,3"]
|===
|File |Purpose

|`ui-config.yml`
|Configures lab navigation, modules, and interface tabs

|`site.yml`
|Sets global variables and theme configuration

|`content/modules/ROOT/pages/*.adoc`
|Educational content written in AsciiDoc format

|`content/antora.yml`
|Antora configuration with inline variables for content rendering
|===

== Quick Start Checklist

Before customizing your template:

. [ ] Clone your template repository
. [ ] Review existing configuration files
. [ ] Plan your lab architecture
. [ ] Identify required instances and their specifications
. [ ] Design network topology if custom networking is needed
. [ ] Determine firewall requirements

== Customization Workflow

. **Design Phase**: Plan your lab environment, learning objectives, and user journey
. **Configure Infrastructure**: Update YAML configuration files for instances, networking, and firewall
. **Create Content**: Develop educational modules using AsciiDoc
. **Configure UI**: Set up navigation, tabs, and interactive elements in `ui-config.yml`
. **Test Locally**: Validate configuration, content, and user interface
. **Deploy**: Push changes and provision lab environment

== Best Practices

* Start with minimal changes and iterate
* Use descriptive names for instances and networks
* Document any custom configurations
* Test firewall rules thoroughly
* Keep security considerations in mind
* Version control all changes
* Review advanced features for Business Unit specific requirements
* Test lab scenarios thoroughly before deployment
* Consider platform architecture when designing complex labs

== ‚ö†Ô∏è CRITICAL REQUIREMENTS

=== Bastion Host Requirement

**At least ONE VM MUST be tagged with the "bastions" Ansible group:**

[source,yaml]
----
virtualmachines:
  - name: "bastion-host"         # At least one bastion required
    tags:
      - key: "AnsibleGroup"
        value: "bastions"        # ‚Üê REQUIRED for deployment
      - key: "ostype"
        value: "linux"
        
  - name: "web-server"          # Other VMs can use different groups
    tags:
      - key: "AnsibleGroup"
        value: "webservers"      # ‚Üê Different group OK
      - key: "ostype"
        value: "linux"
----

The bastion host provides SSH access, user accounts, and terminal integration. Other VMs can use appropriate Ansible groups for their roles (webservers, databases, etc.). Without any bastion, deployment will **fail completely**.

=== Variable Pattern Requirements

**Different files use different variable syntax patterns:**

[cols="2,2,3"]
|===
|File Type |Processing System |Variable Pattern

|`instances.yaml`
`networks.yaml` 
`firewall.yaml`
|AgnosticD/Ansible
|**Jinja2**: `"{{ common_password }}"` ‚Üê **Must be quoted**

|`ui-config.yml`
|Showroom UI
|**Shell-style**: `${guid}`, `${domain}` ‚Üê **No quotes needed**

|Content `.adoc` files
|Antora/AsciiDoc
|Both patterns depending on context
|===

**Critical YAML Requirements:**

[source,yaml]
----
# ‚úÖ CORRECT in instances.yaml
environment:
  PASSWORD: "{{ common_password }}"      # ‚Üê Quoted Jinja2
  SUDO_PASSWORD: "{{ common_password }}" # ‚Üê Quoted Jinja2

# ‚úÖ CORRECT in ui-config.yml  
tabs:
  - name: "App"
    url: https://app-${guid}.${domain}/  # ‚Üê Unquoted shell-style

# ‚ùå WRONG - causes YAML parsing errors
environment:
  PASSWORD: {{ common_password }}        # ‚Üê Unquoted Jinja2 breaks YAML
----

**DNS Naming Consistency:**

[source,yaml]
----
# ‚úÖ CORRECT - Names must match between instances.yaml and ui-config.yml

# instances.yaml
routes:
  - name: webapp           # ‚Üê Route creates DNS name
    host: webapp           # ‚Üê Host must match route name

# ui-config.yml  
tabs:
  - name: "Web App"
    url: https://webapp-${guid}.${domain}/  # ‚Üê URL must match host name

# ‚ùå WRONG - DNS mismatch causes 404 errors
# instances.yaml: host: webapp
# ui-config.yml:  url: https://web-app-${guid}.${domain}/  # ‚Üê Different name!
----

== Advanced Extension Options

=== AgnosticD Workload Extensions

**Beyond Custom Containers**: Zero Touch deployments support **200+ specialized workloads** for advanced lab requirements without custom configuration.

**üîß Alternative to Custom Containers:**
Instead of configuring containers in `instances.yaml`, you can use pre-built workloads in your AgnosticV configuration:

[source,yaml]
----
# In AgnosticV common.yaml - Alternative to custom VS Code container
post_software_workloads:
  bastions:
    - ocp4_workload_codeserver       # Browser-based VS Code IDE
    - ocp4_workload_gitea_operator   # Self-hosted Git platform
    - ocp4_workload_jenkins          # CI/CD pipeline system
----

**üöÄ Popular Extension Workloads:**
- **Development**: `ocp4_workload_devspaces`, `ocp4_workload_codeserver`
- **CI/CD**: `ocp4_workload_pipelines`, `ocp4_workload_gitops_bootstrap`
- **Security**: `ocp4_workload_rhacs`, `ocp4_workload_cert_manager`
- **Databases**: `ocp4_workload_postgresql`, `ocp4_workload_mongodb`
- **Registries**: `ocp4_workload_quay_operator`, `ocp4_workload_nexus_operator`

**‚úÖ Workload Benefits:**
- **Pre-configured**: Enterprise-ready with authentication and security
- **Standardized**: Consistent deployment patterns across environments  
- **Maintained**: Regularly updated by Red Hat engineering teams
- **Integrated**: Access to `guid`, `common_password`, and lab variables

**üìö Complete Reference**: xref:advanced-lab-features.adoc#agnosticd-workload-extensions[AgnosticD Workload Extensions]

[TIP]
====
**Custom vs. Workload Decision Matrix:**

**Use Custom Containers When:**
- You need specific Git repository integration
- Custom user workflows are required
- Educational value of showing configuration details
- Unique networking or SSH requirements

**Use Workloads When:**
- Standard enterprise tools are sufficient
- Faster deployment is prioritized  
- Maintenance overhead should be minimized
- Enterprise authentication patterns are needed
====

=== Network Security Requirements

**CRITICAL for Container SSH Access**: Zero Touch deployments use network policies that **block SSH connections** by default for security.

[IMPORTANT]
====
**If your containers need SSH access to VMs**, you MUST configure network policy rules.

**Architecture**: Containers and VMs deploy to the **same namespace** but are isolated by network policies.
**Problem**: Containers cannot SSH to VMs within the same namespace without explicit policy permission.
**Solution**: Add network policy configuration to your deployment variables.

This is **more restrictive** than cross-namespace communication because both resources are co-located.
====

**Required for VS Code or SSH-enabled containers:**

[source,yaml]
----
# In your sample_vars.yml or deployment configuration
zero_touch_ingress_lockdown_rules:
  - from:
      - podSelector:
          matchLabels:
            app.kubernetes.io/name: showroom  # Existing Showroom access
  - from:  
      - podSelector:
          matchLabels:
            app.kubernetes.io/name: vscode    # Container SSH access
    ports:
      - protocol: TCP
        port: 22
----

**Symptoms of missing network policy:**
- SSH connections timeout or are refused
- `ssh lab-server` fails from container terminals
- Remote SSH extensions fail to connect

**Complete Guide**: xref:network-policy-configuration.adoc[Network Policy Configuration for Container SSH Access]

== Related Documentation

=== Self-Paced Training

* xref:zero-touch-platform-training.adoc[**Zero Touch Platform Training**] - Complete self-paced learning program

=== Core Configuration Guides

* xref:vm-basics.adoc[VM Configuration Basics] and xref:container-basics.adoc[Container Basics]
* xref:networking-basics.adoc[Networking Basics] 
* xref:firewall-basics.adoc[Firewall Configuration Basics]
* xref:content-authoring-basics.adoc[Content Authoring Basics]

=== Advanced Features

* xref:advanced-lab-features.adoc[Advanced Lab Features and Special Cases]
* xref:production-patterns-guide.adoc[Production Lab Patterns Guide]
* xref:enterprise-lab-patterns.adoc[Enterprise Lab Patterns]
* xref:deployment-architecture.adoc[Zero Touch Deployment Architecture]
* xref:network-policy-configuration.adoc[Network Policy Configuration for Container SSH Access]
* xref:git-integration-patterns.adoc[Git Integration Patterns]
* xref:cnv-platform-features.adoc[OpenShift CNV Platform Features]

== Getting Help

If you encounter issues during customization:

. Check the configuration file syntax
. Validate YAML formatting
. Review logs during provisioning
. Consult the template documentation
. Reach out to the platform team for support
